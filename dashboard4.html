<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Drive - Ultimate Clone</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #1a73e8;
            --bg-color: #f7f9fc;
            --surface-color: #ffffff;
            --text-main: #202124;
            --text-secondary: #5f6368;
            --border-color: #dadce0;
            --hover-color: #f1f3f4;
            --sidebar-width: 256px;
            --header-height: 64px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Roboto', sans-serif; }
        body { background-color: var(--surface-color); color: var(--text-main); overflow: hidden; height: 100vh; display: flex; flex-direction: column; }

        /* --- MODALS & PREVIEW --- */
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 2000; display: none;
            justify-content: center; align-items: center;
        }
        
        .preview-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 3000; display: none;
            flex-direction: column;
        }

        .preview-header {
            height: 60px; display: flex; align-items: center; justify-content: space-between;
            padding: 0 20px; color: white; background: linear-gradient(to bottom, rgba(0,0,0,0.6), transparent);
        }

        .preview-content {
            flex: 1; display: flex; justify-content: center; align-items: center; overflow: hidden; padding: 20px;
        }
        .preview-content img { max-width: 100%; max-height: 100%; object-fit: contain; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        .preview-content .doc-preview { background: white; width: 600px; height: 800px; padding: 40px; box-shadow: 0 0 20px black; overflow-y: auto; color: black; }

        /* MODAL STYLES */
        .modal {
            background: white; width: 400px; padding: 24px; border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2); display: flex; flex-direction: column; gap: 15px;
        }
        .modal input { padding: 10px; border: 1px solid #ccc; border-radius: 4px; width: 100%; }
        .modal-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 10px; }
        .btn { padding: 8px 16px; border-radius: 4px; border: none; cursor: pointer; font-weight: 500; }
        .btn-primary { background: var(--primary-color); color: white; }
        .btn-secondary { background: white; color: var(--primary-color); }
        .btn-secondary:hover { background: #f5f5f5; }

        /* --- HEADER --- */
        header { height: var(--header-height); display: flex; align-items: center; padding: 8px 20px; justify-content: space-between; border-bottom: 1px solid var(--border-color); }
        .logo-area { display: flex; align-items: center; width: var(--sidebar-width); }
        .logo-area img { height: 40px; margin-right: 8px; }
        .logo-area span { font-size: 22px; color: var(--text-secondary); }
        
        .search-bar { flex: 1; max-width: 720px; background: #edf2fc; height: 48px; border-radius: 8px; display: flex; align-items: center; padding: 0 12px; margin: 0 20px; }
        .search-bar input { border: none; background: transparent; flex: 1; height: 100%; margin-left: 10px; outline: none; font-size: 16px; }

        .header-actions { display: flex; gap: 12px; align-items: center; }
        .avatar { width: 32px; height: 32px; background-color: purple; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; overflow: hidden; }
        .avatar img { width: 100%; height: 100%; object-fit: cover; }

        /* --- SIDEBAR --- */
        .main-container { display: flex; flex: 1; overflow: hidden; }
        .sidebar { width: var(--sidebar-width); padding: 12px 0; display: flex; flex-direction: column; }
        
        .new-btn {
            display: flex; align-items: center; width: fit-content; height: 48px; background: white;
            border-radius: 24px; padding: 0 24px 0 16px; box-shadow: 0 1px 2px rgba(0,0,0,0.1), 0 2px 6px rgba(0,0,0,0.1);
            margin: 0 0 16px 16px; cursor: pointer; transition: 0.2s; position: relative;
        }
        .new-btn:hover { box-shadow: 0 4px 8px rgba(0,0,0,0.15); background-color: #f8faff; }
        
        .new-dropdown {
            position: absolute; top: 50px; left: 0; background: white; width: 200px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2); border-radius: 4px; display: none; z-index: 100; padding: 5px 0;
        }
        .new-dropdown div { padding: 10px 20px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 14px; }
        .new-dropdown div:hover { background: #f1f3f4; }

        .nav-item { display: flex; align-items: center; height: 40px; padding-left: 24px; border-radius: 0 20px 20px 0; cursor: pointer; color: var(--text-main); font-size: 14px; margin-right: 12px; }
        .nav-item.active { background-color: #e8f0fe; color: var(--primary-color); font-weight: 500; }
        .nav-item:hover:not(.active) { background-color: var(--hover-color); }

        /* --- CONTENT --- */
        .content { flex: 1; background-color: var(--surface-color); border-radius: 16px 16px 0 0; padding: 16px; overflow-y: auto; border-top: 1px solid var(--border-color); border-left: 1px solid var(--border-color); display: flex; flex-direction: column;}
        
        .breadcrumb-bar { font-size: 18px; padding-bottom: 15px; border-bottom: 1px solid var(--border-color); margin-bottom: 10px; display: flex; gap: 5px; align-items: center; color: var(--text-secondary); }
        .crumb { cursor: pointer; padding: 4px 8px; border-radius: 4px; }
        .crumb:hover { background: #f1f3f4; color: black; }
        .crumb:last-child { color: black; font-weight: 500; cursor: default; }

        .file-list-header { display: grid; grid-template-columns: 2fr 1fr 1fr 50px; padding: 8px 16px; border-bottom: 1px solid var(--border-color); color: var(--text-secondary); font-size: 13px; font-weight: 500; }
        .file-row { display: grid; grid-template-columns: 2fr 1fr 1fr 50px; padding: 12px 16px; border-bottom: 1px solid #f1f3f4; align-items: center; font-size: 13px; cursor: pointer; user-select: none; }
        .file-row:hover { background-color: #e8f0fe; }
        .file-name-cell { display: flex; align-items: center; color: var(--text-main); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .file-name-cell .material-icons-outlined { margin-right: 12px; font-size: 20px; color: var(--text-secondary); }
        
        /* CONTEXT MENU */
        .menu-btn { border: none; background: transparent; cursor: pointer; border-radius: 50%; padding: 4px; opacity: 0; }
        .file-row:hover .menu-btn { opacity: 1; }
        .context-menu {
            position: absolute; right: 50px; top: 30px; background: white; 
            border: 1px solid var(--border-color); box-shadow: 0 2px 10px rgba(0,0,0,0.2); 
            border-radius: 4px; z-index: 100; display: none; width: 180px;
        }
        .context-menu div { padding: 10px 15px; cursor: pointer; display: flex; align-items: center; gap: 10px; }
        .context-menu div:hover { background: #f1f3f4; }
        
        /* PROFILE POPUP */
        .profile-popup {
            position: absolute; top: 60px; right: 20px; width: 320px; background: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15); border-radius: 10px; z-index: 150; padding: 20px;
            display: none; text-align: center; border: 1px solid #e0e0e0;
        }
        .profile-popup .large-avatar { width: 80px; height: 80px; background: purple; border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; font-size: 32px; color: white; position: relative; overflow: hidden; }
        .profile-popup .large-avatar img { width: 100%; height: 100%; object-fit: cover; }
        
        .other-account { display: flex; align-items: center; padding: 10px; border-top: 1px solid #eee; cursor: pointer; text-align: left; }
        .other-account:hover { background: #f7f9fc; }
        .other-avatar { width: 32px; height: 32px; border-radius: 50%; background: #e0e0e0; display: flex; align-items: center; justify-content: center; margin-right: 12px; font-size: 14px; }
        
    </style>
</head>
<body>

    <div id="loginOverlay" class="overlay" style="display: flex; background: white;">
        <div class="modal" style="text-align: center; border: 1px solid #dadce0; box-shadow: none;">
            <img src="https://upload.wikimedia.org/wikipedia/commons/d/da/Google_Drive_logo_%282020%29.svg" width="60" style="margin: 0 auto;">
            <h2>Sign in</h2>
            <p>to continue to Drive</p>
            <input type="text" id="loginEmail" placeholder="Email" value="user@gmail.com">
            <button class="btn btn-primary" onclick="login()">Next</button>
        </div>
    </div>

    <div id="app" style="display:none; height: 100%; flex-direction: column;">
        <header>
            <div class="logo-area">
                <img src="https://upload.wikimedia.org/wikipedia/commons/d/da/Google_Drive_logo_%282020%29.svg" alt="Drive">
                <span>Drive</span>
            </div>
            <div class="search-bar">
                <span class="material-icons-outlined" style="color: #5f6368;">search</span>
                <input type="text" placeholder="Search in Drive" id="searchInput" onkeyup="renderFiles()">
            </div>
            <div class="header-actions">
                <span class="material-icons-outlined icon-btn">help_outline</span>
                <span class="material-icons-outlined icon-btn">settings</span>
                <div class="avatar" onclick="toggleProfile()">
                    <span id="headerAvatarText">U</span>
                    <img id="headerAvatarImg" style="display:none;">
                </div>
            </div>
            
            <div class="profile-popup" id="profilePopup">
                <div class="large-avatar">
                    <span id="popupAvatarText">U</span>
                    <img id="popupAvatarImg" style="display:none;">
                </div>
                <h3 id="displayName">User Name</h3>
                <p id="displayEmail" style="color:gray; font-size:14px; margin-bottom:15px;">user@example.com</p>
                <button class="btn btn-secondary" style="border:1px solid #dadce0; width:100%" onclick="alert('Settings Page')">Manage Account</button>
                
                <div id="accountList" style="margin-top: 15px;">
                    </div>
                
                <div class="other-account" onclick="addNewAccount()">
                    <div class="other-avatar"><span class="material-icons-outlined">person_add</span></div>
                    <div style="font-size:14px;">Add another account</div>
                </div>

                <div style="border-top:1px solid #eee; margin-top:10px; padding-top:10px;">
                    <button class="btn" style="background:white; border:1px solid #ccc" onclick="location.reload()">Sign out of all accounts</button>
                </div>
            </div>
        </header>

        <div class="main-container">
            <aside class="sidebar">
                <div class="new-btn" onclick="toggleNewMenu()">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/9/9e/Plus_symbol.svg" width="24">
                    <span>New</span>
                    <div class="new-dropdown" id="newMenu">
                        <div onclick="createFolderPrompt()"><span class="material-icons-outlined">create_new_folder</span> New Folder</div>
                        <div onclick="document.getElementById('fileUpload').click()"><span class="material-icons-outlined">upload_file</span> File Upload</div>
                        <div onclick="createTxtFile()"><span class="material-icons-outlined">description</span> New Doc</div>
                    </div>
                </div>
                <input type="file" id="fileUpload" hidden onchange="handleFileUpload(event)">
                
                <div class="nav-item active" onclick="switchView('drive')" id="nav-drive"><span class="material-icons-outlined">hard_drive</span> My Drive</div>
                <div class="nav-item" onclick="switchView('recent')" id="nav-recent"><span class="material-icons-outlined">schedule</span> Recent</div>
                <div class="nav-item" onclick="switchView('trash')" id="nav-trash"><span class="material-icons-outlined">delete</span> Trash</div>
            </aside>

            <main class="content">
                <div class="breadcrumb-bar" id="breadcrumbs">My Drive</div>

                <div class="file-list-header">
                    <div>Name</div>
                    <div>Owner</div>
                    <div>Last Modified</div>
                    <div></div>
                </div>
                <div id="fileList">
                    </div>
            </main>
        </div>
    </div>

    <div id="previewOverlay" class="preview-overlay">
        <div class="preview-header">
            <div style="display:flex; align-items:center; gap:10px;">
                <span class="material-icons-outlined" onclick="closePreview()" style="cursor:pointer">arrow_back</span>
                <span id="previewTitle">Filename.png</span>
            </div>
            <div>
                <span class="material-icons-outlined icon-btn" style="color:white">download</span>
                <span class="material-icons-outlined icon-btn" style="color:white">more_vert</span>
            </div>
        </div>
        <div class="preview-content" id="previewContainer">
            </div>
    </div>

    <div id="moveModal" class="overlay">
        <div class="modal">
            <h3>Move to...</h3>
            <div id="folderList" style="max-height: 200px; overflow-y: auto; border: 1px solid #eee;"></div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="document.getElementById('moveModal').style.display='none'">Cancel</button>
                <button class="btn btn-primary" onclick="confirmMove()">Move Here</button>
            </div>
        </div>
    </div>

    <script>
        // --- DATA & STATE ---
        let currentView = 'drive'; // 'drive', 'recent', 'trash'
        let currentFolderId = null;
        let selectedFileId = null;

        // Accounts System
        let accounts = [
            { name: "Demo User", email: "user@gmail.com", color: "purple" }
        ];
        let currentAccountIndex = 0;

        // File System
        let fileSystem = [
            { id: 1, parentId: null, name: "Documents", type: "folder", date: "Jan 10", trashed: false },
            { id: 2, parentId: null, name: "Pictures", type: "folder", date: "Jan 12", trashed: false },
            { id: 3, parentId: 1, name: "Resume.pdf", type: "file", date: "Feb 01", trashed: false },
            { id: 4, parentId: null, name: "Vacation.png", type: "file", date: "Today", trashed: false, isMock: true }
        ];

        // --- AUTH ---
        function login() {
            document.getElementById('loginOverlay').style.display = 'none';
            document.getElementById('app').style.display = 'flex';
            renderAccounts();
            renderFiles();
        }

        function renderAccounts() {
            const user = accounts[currentAccountIndex];
            document.getElementById('displayName').innerText = user.name;
            document.getElementById('displayEmail').innerText = user.email;
            document.getElementById('headerAvatarText').innerText = user.name[0];
            document.getElementById('popupAvatarText').innerText = user.name[0];
            
            // Render other accounts in list
            const list = document.getElementById('accountList');
            list.innerHTML = '';
            accounts.forEach((acc, idx) => {
                if(idx !== currentAccountIndex) {
                    list.innerHTML += `
                    <div class="other-account" onclick="switchAccount(${idx})">
                        <div class="other-avatar" style="background:${acc.color}; color:white">${acc.name[0]}</div>
                        <div>
                            <div style="font-weight:500">${acc.name}</div>
                            <div style="font-size:12px; color:gray">${acc.email}</div>
                        </div>
                    </div>`;
                }
            });
        }

        function addNewAccount() {
            const email = prompt("Enter new email address:");
            if(email) {
                accounts.push({ name: email.split('@')[0], email: email, color: "orange" });
                renderAccounts();
            }
        }

        function switchAccount(idx) {
            currentAccountIndex = idx;
            renderAccounts();
            toggleProfile();
            alert(`Switched to ${accounts[idx].email}`);
        }

        // --- NAVIGATION ---
        function switchView(view) {
            currentView = view;
            currentFolderId = null; // Reset to root for view changes
            
            // Update Sidebar UI
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById('nav-'+view).classList.add('active');
            
            renderFiles();
            renderBreadcrumbs();
        }

        function enterFolder(id) {
            if(currentView === 'trash') return; // Cannot enter folders in trash
            currentFolderId = id;
            renderFiles();
            renderBreadcrumbs();
        }

        function renderBreadcrumbs() {
            const b = document.getElementById('breadcrumbs');
            if(currentView === 'recent') { b.innerText = 'Recent'; return; }
            if(currentView === 'trash') { b.innerText = 'Trash'; return; }

            // Build Breadcrumb Path
            let path = [];
            let curr = currentFolderId;
            while(curr !== null) {
                let f = fileSystem.find(x => x.id === curr);
                if(f) { path.unshift(f); curr = f.parentId; } else curr = null;
            }
            
            let html = `<span class="crumb" onclick="currentFolderId=null; renderFiles(); renderBreadcrumbs()">My Drive</span>`;
            path.forEach(p => {
                html += ` > <span class="crumb" onclick="enterFolder(${p.id})">${p.name}</span>`;
            });
            b.innerHTML = html;
        }

        // --- RENDER ENGINE ---
        function renderFiles() {
            const list = document.getElementById('fileList');
            list.innerHTML = '';
            const search = document.getElementById('searchInput').value.toLowerCase();

            let items = fileSystem.filter(f => {
                // Search Override
                if(search) return f.name.toLowerCase().includes(search) && !f.trashed;

                if(currentView === 'trash') return f.trashed;
                if(currentView === 'recent') return !f.trashed && f.type === 'file'; // Recent shows flat list of files
                // Default Drive View
                return !f.trashed && f.parentId === currentFolderId;
            });

            // Sorting logic
            if(currentView === 'recent') {
                // Mock sort by date (reverse addition order)
                items.reverse(); 
            } else {
                // Folders first
                items.sort((a,b) => (a.type === b.type ? 0 : a.type === 'folder' ? -1 : 1));
            }

            items.forEach(file => {
                const row = document.createElement('div');
                row.className = 'file-row';
                
                // Click handlers
                row.ondblclick = () => {
                    if(file.type === 'folder') enterFolder(file.id);
                    else openPreview(file.id);
                };

                // Icons
                let icon = 'description';
                let color = '#5f6368';
                if(file.type === 'folder') { icon = 'folder'; color = '#5f6368'; }
                else if(file.name.endsWith('.pdf')) { icon = 'picture_as_pdf'; color = '#ea4335'; }
                else if(file.name.endsWith('.png') || file.name.endsWith('.jpg')) { icon = 'image'; color = '#d93025'; }

                // Context Menu HTML
                const restoreOption = file.trashed ? 
                    `<div onclick="restoreFile(${file.id})"><span class="material-icons-outlined">restore_from_trash</span> Restore</div>
                     <div onclick="deleteForever(${file.id})" style="color:red"><span class="material-icons-outlined">delete_forever</span> Delete Forever</div>` 
                    : 
                    `<div onclick="openPreview(${file.id})"><span class="material-icons-outlined">visibility</span> Preview</div>
                     <div onclick="copyFile(${file.id})"><span class="material-icons-outlined">content_copy</span> Make a copy</div>
                     <div onclick="initMove(${file.id})"><span class="material-icons-outlined">drive_file_move</span> Move to</div>
                     <div onclick="initRename(${file.id})"><span class="material-icons-outlined">edit</span> Rename</div>
                     <div onclick="trashFile(${file.id})" style="color:red"><span class="material-icons-outlined">delete</span> Remove</div>`;

                row.innerHTML = `
                    <div class="file-name-cell">
                        <span class="material-icons-outlined" style="margin-right:12px; color:${color};">${icon}</span>
                        ${file.name}
                    </div>
                    <div>${accounts[currentAccountIndex].name}</div>
                    <div>${file.date}</div>
                    <div style="position:relative">
                        <button class="menu-btn" onclick="toggleCtx(event, ${file.id})">
                            <span class="material-icons-outlined">more_vert</span>
                        </button>
                        <div id="menu-${file.id}" class="context-menu">
                            ${restoreOption}
                        </div>
                    </div>
                `;
                list.appendChild(row);
            });

            if(items.length === 0) list.innerHTML = `<div style="padding:20px; color:gray; text-align:center">No files found</div>`;
        }

        // --- PREVIEW SYSTEM ---
        function openPreview(id) {
            closeCtx();
            const file = fileSystem.find(f => f.id === id);
            if(!file || file.type === 'folder') return;

            const overlay = document.getElementById('previewOverlay');
            const container = document.getElementById('previewContainer');
            document.getElementById('previewTitle').innerText = file.name;
            
            overlay.style.display = 'flex';
            container.innerHTML = '';

            // Handle Preview Types
            if(file.fileObj) {
                // Real Uploaded File
                const url = URL.createObjectURL(file.fileObj);
                if(file.name.match(/\.(jpeg|jpg|png|gif)$/i)) {
                    container.innerHTML = `<img src="${url}">`;
                } else if (file.name.endsWith('.txt')) {
                    const reader = new FileReader();
                    reader.onload = (e) => { container.innerHTML = `<div class="doc-preview"><pre>${e.target.result}</pre></div>`; };
                    reader.readAsText(file.fileObj);
                } else {
                    container.innerHTML = `<div style="color:white; text-align:center"><span class="material-icons-outlined" style="font-size:64px">description</span><br>No preview available</div>`;
                }
            } else if (file.isMock && file.name.endsWith('.png')) {
                // Mock Image
                container.innerHTML = `<img src="https://via.placeholder.com/800x600?text=${file.name}">`;
            } else {
                // Generic
                container.innerHTML = `<div class="doc-preview"><h3>${file.name}</h3><p>This is a text preview of the document content.</p></div>`;
            }
        }

        function closePreview() {
            document.getElementById('previewOverlay').style.display = 'none';
        }

        // --- FILE ACTIONS ---
        function handleFileUpload(e) {
            const file = e.target.files[0];
            if(file) {
                fileSystem.push({
                    id: Date.now(),
                    parentId: currentFolderId,
                    name: file.name,
                    type: 'file',
                    date: new Date().toLocaleDateString(),
                    trashed: false,
                    fileObj: file // Store blob for preview/download
                });
                renderFiles();
            }
            toggleNewMenu();
        }

        function createFolderPrompt() {
            const name = prompt("Folder Name:");
            if(name) {
                fileSystem.push({ id: Date.now(), parentId: currentFolderId, name, type: 'folder', date: 'Today', trashed: false });
                renderFiles();
            }
            toggleNewMenu();
        }
        
        function createTxtFile() {
             fileSystem.push({ id: Date.now(), parentId: currentFolderId, name: 'Untitled.txt', type: 'file', date: 'Today', trashed: false });
             renderFiles();
             toggleNewMenu();
        }

        function copyFile(id) {
            closeCtx();
            const file = fileSystem.find(f => f.id === id);
            if(file) {
                // Clone object
                const newFile = { ...file, id: Date.now(), name: "Copy of " + file.name };
                fileSystem.push(newFile);
                renderFiles();
            }
        }

        function initRename(id) {
            closeCtx();
            const file = fileSystem.find(f => f.id === id);
            const newName = prompt("Rename:", file.name);
            if(newName) { file.name = newName; renderFiles(); }
        }

        function trashFile(id) {
            closeCtx();
            const file = fileSystem.find(f => f.id === id);
            file.trashed = true;
            renderFiles();
        }

        function restoreFile(id) {
            closeCtx();
            const file = fileSystem.find(f => f.id === id);
            file.trashed = false;
            renderFiles();
        }

        function deleteForever(id) {
            if(confirm("Delete forever? This cannot be undone.")) {
                fileSystem = fileSystem.filter(f => f.id !== id);
                renderFiles();
            }
        }

        function initMove(id) {
            closeCtx();
            selectedFileId = id;
            const list = document.getElementById('folderList');
            list.innerHTML = `<div style="padding:10px; cursor:pointer" onclick="selectMoveTarget(null)">My Drive</div>`;
            fileSystem.filter(f => f.type === 'folder' && !f.trashed && f.id !== id).forEach(f => {
                list.innerHTML += `<div style="padding:10px; cursor:pointer; border-top:1px solid #eee" onclick="selectMoveTarget(${f.id})">üìÅ ${f.name}</div>`;
            });
            document.getElementById('moveModal').style.display = 'flex';
        }

        let moveTarget = null;
        function selectMoveTarget(id) { moveTarget = id; }
        function confirmMove() {
            const file = fileSystem.find(f => f.id === selectedFileId);
            if(file) file.parentId = moveTarget;
            document.getElementById('moveModal').style.display = 'none';
            renderFiles();
        }

        // --- UTILS ---
        function toggleNewMenu() {
            const m = document.getElementById('newMenu');
            m.style.display = m.style.display === 'block' ? 'none' : 'block';
        }
        function toggleProfile() {
            const m = document.getElementById('profilePopup');
            m.style.display = m.style.display === 'block' ? 'none' : 'block';
        }
        function toggleCtx(e, id) {
            e.stopPropagation();
            closeCtx();
            document.getElementById('menu-'+id).style.display = 'block';
        }
        function closeCtx() {
            document.querySelectorAll('.context-menu').forEach(e => e.style.display = 'none');
        }
        window.onclick = function(e) {
            if(!e.target.closest('.menu-btn')) closeCtx();
            if(!e.target.closest('.new-btn')) document.getElementById('newMenu').style.display = 'none';
        }
    </script>
</body>
</html>
